!function(a){for(var b=0,c=["webkit","moz"],d=a.requestAnimationFrame,e=a.cancelAnimationFrame,f=c.length;--f>=0&&!d;)d=a[c[f]+"RequestAnimationFrame"],e=a[c[f]+"CancelAnimationFrame"];d&&e||(d=function(a){var c=+new Date,d=Math.max(b+16,c);return setTimeout(function(){a(b=d)},d-c)},e=clearTimeout),a.requestAnimationFrame=d,a.cancelAnimationFrame=e}(window),function(a){"use strict";var b={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(b.exports={},define(function(){return b.exports})):b.exports="undefined"!=typeof window?window:a:b.exports=exports,function(a){if(!b)var b=1e-6;if(!c)var c="undefined"!=typeof Float32Array?Float32Array:Array;if(!d)var d=Math.random;var e={};e.setMatrixArrayType=function(a){c=a},"undefined"!=typeof a&&(a.glMatrix=e);var f=Math.PI/180;e.toRadian=function(a){return a*f};var g={};g.create=function(){var a=new c(16);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},g.clone=function(a){var b=new c(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b},g.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},g.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},g.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a},g.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null},g.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a},g.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x},g.translate=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a},g.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a},g.rotate=function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=e[0],E=e[1],F=e[2],G=Math.sqrt(D*D+E*E+F*F);return Math.abs(G)<b?null:(G=1/G,D*=G,E*=G,F*=G,f=Math.sin(d),g=Math.cos(d),h=1-g,i=c[0],j=c[1],k=c[2],l=c[3],m=c[4],n=c[5],o=c[6],p=c[7],q=c[8],r=c[9],s=c[10],t=c[11],u=D*D*h+g,v=E*D*h+F*f,w=F*D*h-E*f,x=D*E*h-F*f,y=E*E*h+g,z=F*E*h+D*f,A=D*F*h+E*f,B=E*F*h-D*f,C=F*F*h+g,a[0]=i*u+m*v+q*w,a[1]=j*u+n*v+r*w,a[2]=k*u+o*v+s*w,a[3]=l*u+p*v+t*w,a[4]=i*x+m*y+q*z,a[5]=j*x+n*y+r*z,a[6]=k*x+o*y+s*z,a[7]=l*x+p*y+t*z,a[8]=i*A+m*B+q*C,a[9]=j*A+n*B+r*C,a[10]=k*A+o*B+s*C,a[11]=l*A+p*B+t*C,c!==a&&(a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15]),a)},g.perspective=function(a,b,c,d,e){var f=1/Math.tan(b/2),g=1/(d-e);return a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(e+d)*g,a[11]=-1,a[12]=0,a[13]=0,a[14]=2*e*d*g,a[15]=0,a},"undefined"!=typeof a&&(a.mat4=g)}(b.exports)}(this),function(){"use strict";function a(){var a={fac:{},inst:{},val:function(b,c){a.inst[b]=c},set:function(b,c){a.inst[b]=null,a.fac[b]=c},get:function(b){return a.inst[b]||(a.inst[b]=a.make(b))},make:function(b){var c=a.fac[b];if(c)return console.log("dimk: "+b),c();throw new Error("Factory Not Found!! "+b)}};return a}window.nsR=a;var b=a();window._di=b,b.val("nsR",a)}(),function(a){"use strict";a.val("util.degToRad",function b(a){return b.RADIAN=b.RADIAN||Math.PI/180,a*b.RADIAN}),a.set("DoublyLinkedList",function(){var a=function(){this.___next=this,this.___prev=this,this.length=0};return a.prototype={constructor:a,unshift:function(a){this.length++,this.append(a,this)},push:function(a){this.length++,this.append(a,this.___prev)},shift:function(){return this.length--,this.___next===this?!1:this.remove(this.___next)},pop:function(){return this.length--,this.___prev===this?!1:this.remove(this.___prev)},append:function(a,b){a.___next=b.___next,a.___prev=b,b.___next.___prev=a,b.___next=a},remove:function(a){return a.___next.___prev=a.___prev,a.___prev.___next=a.___next,a},each:function(a){for(var b=this.___next;b!==this;b=b.___next)a(b)},empty:function(){return this.___next===this}},a}),a.val("util.mvStack",function(){var b=a.get("util.pool")();b._fac=function(){return mat4.create()},b._reset=function(a){return a.___next=null,a.___prev=null,mat4.identity(a)},b.prep(3);var c={},d=a.get("DoublyLinkedList"),e=new d,f=e;return c.mvMatrix=b.alloc(),c.pMatrix=mat4.create(),c.mvSave=function(){var a=b.alloc();mat4.copy(a,c.mvMatrix),f.push(a)},c.mvRestore=function(){if(0===f.length)throw"no more to pop!";b.free(c.mvMatrix),c.mvMatrix=f.pop()},c}),a.set("FrbT",function(){function b(){this.fn=null,this.ctx=null,this.data=null,this.args=null,this.___next=null,this.___prev=null}function c(){var a=this;this.frameBudget=3,this.state={finished:!1},this.prebind={digest:a.digest.bind(a)};var c=new d;this.asyncStack=c;var f=e();f.noop=function(){},f._fac=function(){return new b},f._reset=b.prototype.reset,f.prep(3),this.pool=f}var d=a.get("DoublyLinkedList"),e=a.get("util.pool");return b.prototype.reset=function(a){return a.___next=null,a.___prev=null,a},c.prototype={constructor:c,updateFrameBudget:function(a){this.frameBudget=a},addTask:function(a,b,c,d){var e=this.pool.alloc();e.fn=a,e.data=c,e.ctx=b,e.args=d,this.asyncStack.push(e),this.state.finished=!1},stepTask:function(a){this.taskStepper(this.asyncStack,a,this.frameBudget)},taskStepper:function(a,b,c){if(0!==a.length){var d,e,f=window.performance;do d=a.shift(),"undefined"!=typeof d&&"function"==typeof d.fn&&("undefined"!=typeof d.args?d.fn.apply(d.ctx,d.args):d.fn.call(d.ctx,d.data)),e=f.now()-b,this.pool.free(d);while(a.length>0&&c>e)}},checkFinish:function(){var a=0===this.asyncStack.length;return a&&(this.state.finished=!0),a},digest:function(a){this.stepTask(a||window.performance.now()||Date.now()),this.state.finished||this.checkFinish()||window.requestAnimationFrame(this.prebind.digest)}},c}),a.set("service.frbt",function(){var b=a.get("FrbT");return new b}),a.val("util.pool",function(){var b=a.get("DoublyLinkedList"),c=new b,d={useCount:0,_free:c,_reset:function(a){console.log("_resetter not ready!",a)},_fac:function(){console.log("_factory not ready!")},make:function(){return d._fac()},makeFree:function(){d._free.push(d.make())},getFree:function(){return d._free.shift()},prep:function(a){for(var b=0;a>b;b++)d.makeFree()},alloc:function(){var a=d.getFree();return a||(d.makeFree(),a=d.getFree()),d._reset(a),d.useCount++,a},free:function(a){d._reset(a),d._free.push(a),d.useCount--}};return d}),a.val("util.getShader",function(a,b,c){var d;"vs"===c?d=a.createShader(a.VERTEX_SHADER):"fs"===c?d=a.createShader(a.FRAGMENT_SHADER):console.log("shader creation error!!!"),a.shaderSource(d,b),a.compileShader(d);var e=a.getShaderParameter(d,a.COMPILE_STATUS);return e||console.error("shader compile error",a.getShaderInfoLog(d)),d}),a.val("util.makeProgramFromDom",function(b,c){var d=a.get("util.getDomSrc"),e=a.get("util.makeProgramFromSrc");return e(d(b),d(c))}),a.val("util.makeProgramFromSrc",function(b,c){var d=a.get("context"),e=a.get("util.getShader"),f=e(d,b,"vs"),g=e(d,c,"fs"),h=d.createProgram();return d.attachShader(h,f),d.attachShader(h,g),d.linkProgram(h),h.defaultName=f.length+g.length,d.getProgramParameter(h,d.LINK_STATUS)||console.log("cannot link shader"),d.useProgram(h),h}),a.val("util.getLocationCacheManual",function(b,c,d){for(var e,f=a.get("context"),g={program:b},h=0;h<c.length;h++){if(e=f.getAttribLocation(b,c[h]),"undefined"==typeof e)throw new Error("attribute not found :"+c[h]);g[c[h]]=e,f.enableVertexAttribArray(e)}for(var i=0;i<d.length;i++){if(e=f.getUniformLocation(b,d[i]),"undefined"==typeof e)throw new Error("unifrom not found :"+d[i]);g[d[i]]=e,g[d[i]].___uniformName=d[i]}return g}),a.val("util.getLocationCache",function(b){var c,d,e,f,g,h=a.get("context"),i={program:b};for(d=h.getProgramParameter(b,h.ACTIVE_ATTRIBUTES),c=0;d>c;c++)e=h.getActiveAttrib(b,c),g=h.getAttribLocation(b,e.name),i[e.name]=g,h.enableVertexAttribArray(g);for(d=h.getProgramParameter(b,h.ACTIVE_UNIFORMS),c=0;d>c;c++)f=h.getActiveUniform(b,c),i[f.name]=h.getUniformLocation(b,f.name),i[f.name].___uniformName=f.name;return console.table([i]),i}),a.val("fac.check",function(b){var c={},d=b||a.get("context");return c.vertexSampler=d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>=1,c.oesFloat=!!d.getExtension("OES_texture_float"),c.makeTestTextureFBO=function(a){var b=10,c=10,e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,b,c,0,d.RGBA,a,null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!1),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);var f=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,f);var g=d.createRenderbuffer();d.bindRenderbuffer(d.RENDERBUFFER,g),d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,b,c),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,e,0),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,g);var h=d.checkFramebufferStatus(d.FRAMEBUFFER);return{attachment:h===d.FRAMEBUFFER_COMPLETE,fbo:f}},c.cleanUpBinding=function(){d.bindTexture(d.TEXTURE_2D,null),d.bindRenderbuffer(d.RENDERBUFFER,null),d.bindFramebuffer(d.FRAMEBUFFER,null)},c.checkFloatTextureAttachment=function(){var a=c.makeTestTextureFBO(d.FLOAT);c.floatTextureAttachment=a.attachment?!0:!1,c.cleanUpBinding()},c.checkFloatTextureAttachment(),c.checkBtyesTextureAttachment=function(){var a=c.makeTestTextureFBO(d.UNSIGNED_BYTE);c.bytesTextureAttachment=a.attachment?!0:!1,c.cleanUpBinding()},c.checkBtyesTextureAttachment(),c.gpuSim=c.vertexSampler&&c.oesFloat&&(c.floatTextureAttachment||c.checkBtyesTextureAttachment)?!0:!1,c}),a.set("service.support",function(){return a.get("fac.check")()}),a.set("program.fan",function(){var b=a.get("util.getLocationCache"),c=a.get("util.makeProgramFromSrc")(a.get("scripts/shaders/fan.vs"),a.get("scripts/shaders/fan.fs")),d=b(c);return d}),a.set("program.cube.sampler",function(){var b=a.get("util.getLocationCache"),c=a.get("util.makeProgramFromSrc")(a.get("scripts/shaders/cube.sampler.vs"),a.get("scripts/shaders/cube.sampler.fs")),d=["uMVMatrix","uPMatrix","uSampler","uSReady","uCTime"],e=["aVertexPosition","aTextureCoord"],f=b(c,e,d);return f}),a.set("program.post.blur",function(){var b=a.get("util.getLocationCache"),c=a.get("util.makeProgramFromSrc")(a.get("scripts/shaders/post.blur.vs"),a.get("scripts/shaders/post.blur.fs")),d=b(c),e=a.get("context"),f=a.get("service.clock");return d.type="blur",d.simulate=function(){e.uniform1f(d.uVibrate,Math.sin(f.eTime+10*f.sTime))},d}),a.set("program.post.normal",function(){var b=a.get("util.getLocationCache"),c=a.get("util.makeProgramFromSrc")(a.get("scripts/shaders/post.normal.vs"),a.get("scripts/shaders/post.normal.fs")),d=b(c);return d.type="normal",d.simulate=function(){},d}),a.set("program.particle.simulate",function(){var b=a.get("util.getLocationCache"),c=a.get("util.makeProgramFromSrc")(a.get("scripts/shaders/particle.simulate.vs"),a.get("scripts/shaders/particle.simulate.fs")),d=b(c),e=a.get("service.clock"),f=a.get("context");return d.type="particle",d.simulate=function(){f.uniform1f(d.uTimer,e.cTime)},d}),a.set("program.particle.show",function(){var b=a.get("util.getLocationCache"),c=a.get("util.makeProgramFromSrc")(a.get("scripts/shaders/particle.show.vs"),a.get("scripts/shaders/particle.show.fs")),d=b(c);return d.type="particle",d}),a.set("canvas",function(){var a=document.getElementById("ww");return a}),a.val("util.makeContext",function(){var b=a.get("canvas"),c=b.getContext("webgl");return c&&(c.viewportWidth=b.width,c.viewportHeight=b.height),c}),a.set("context",function(){var b;return b=a.get("util.makeContext")()}),a.set("service.contextLost",function(){var b=a.get("canvas"),c=a.get("loop");b.addEventListener("webglcontextlost",function(a){a.preventDefault(),console.log("context lost!"),c.stop()},!1),b.addEventListener("webglcontextrestored",function(){window.location.assign(window.location.href)},!1)}),a.set("loop",function(){function b(){console.log("STARTING..."),i||(i=!0,h=window.requestAnimationFrame(d))}function c(){console.log("STOPPING..."),window.cancelAnimationFrame(h),h=null}function d(a){null!==h&&(h=window.requestAnimationFrame(d),g.updateTime(a),f(a),e.stepTask(a),i=!1)}var e=a.get("service.frbt"),f=a.get("render"),g=a.get("service.clock"),h=0,i=!1;return{start:b,stop:c}}),a.set("service.focus",function(){function b(){d.start()}function c(){d.stop()}var d=a.get("loop");window.addEventListener("focus",b,!1),window.addEventListener("blur",c,!1)}),a.set("service.keydown",function(){function a(a){c[a.keyCode]=!0}function b(a){c[a.keyCode]=!1}var c={};return window.addEventListener("keydown",a,!1),window.addEventListener("keyup",b,!1),c}),a.set("service.toggle",function(){function a(a){b[a.keyCode]=b[a.keyCode]?!1:!0}var b={};return window.addEventListener("keyup",a,!1),b}),a.val("util.clock",function(){var a={};return a.lastTime=0,a.cTime=null,a.eTime=0,a.sTime=0,a.now=function(a){var b=a||window.performance.now()||Date.now()||(new Date).getTime();return b},a.updateTime=function(b){if(a.cTime=a.now(b),0!==a.lastTime){var c=a.cTime-a.lastTime;return a.eTime=c,a.lastTime=a.cTime,a.sTime=a.sTime+.01,c}return a.lastTime=a.cTime,a.eTime=!1,!1},a.resetTime=function(){a.lastTime=0,a.sTime=0},a}),a.set("service.clock",function(){return a.get("util.clock")()}),a.val("util.lazyGL",function(){var b=a.get("context"),c={ask:{},mem:{},lazy:{_f:{}}},d={};c.useProgram=function(a){d.prog!==a&&(b.useProgram(a),d.prog=a)};var e={};c.uniform1i=function(a,c){var d=a.___uniformName;e[d]!==c&&(b.uniform1i(a,c),e[d]=c)};var f={};c.uniform1f=function(a,c){var d=a.___uniformName;f[d]!==c&&(b.uniform1f(a,c),f[d]=c)};var g={NS1:"1",NS2:"2",NS3:"3"};c.uniform3f=function(a,c,d,e){var f=a.___uniformName;(g[f+g.NS1]!==c||g[f+g.NS2]!==d||g[f+g.NS3]!==e)&&(b.uniform3f(a,c,d,e),g[f+g.NS1]=c,g[f+g.NS2]=d,g[f+g.NS3]=e)};var h={NS1:"1",NS2:"2"};c.uniformMatrix4fv=function(a,c,d){var e=a.___uniformName;if(!e)throw new Error("cannot find unifrom name");(h[e+h.NS1]!==c||h[e+h.NS2]!==d)&&(b.uniformMatrix4fv(a,c,d),h[e+h.NS1]=c,h[e+h.NS2]=d)};var i={};c.bindBuffer=function(a,c){i[a!==c]&&b.bindBuffer(a,c)};var j={};c.ask.vertexAttribPointer=function(a,b,c,e,f,g){if(!j[a]){if(-1===a||"undefined"==typeof a)throw new Error("location not found!!: "+a);j[a]={}}return j[a].p!==d.prog||j[a].a0!==a||j[a].a1!==b||j[a].a2!==c||j[a].a3!==e||j[a].a4!==f||j[a].a5!==g?!0:!1},c.mem.vertexAttribPointer=function(a,b,c,e,f,g){j[a].p=d.prog,j[a].a0=a,j[a].a1=b,j[a].a2=c,j[a].a3=e,j[a].a4=f,j[a].a5=g},c.lazy._f.vertexAttribPointer=function(a,c,d,e,f,g,h,i){b.bindBuffer(a,c),b.vertexAttribPointer(d,e,f,g,h,i)},c.lazy.vertexAttribPointer=function(a,d,e,f,g,h,i,j){c.ask.vertexAttribPointer(e,f,g,h,i,j)&&(b.bindBuffer(a,d),b.vertexAttribPointer(e,f,g,h,i,j),c.mem.vertexAttribPointer(e,f,g,h,i,j))},c.vertexAttribPointer=function(a,d,e,f,g,h){c.ask.vertexAttribPointer(a,d,e,f,g,h)&&(b.vertexAttribPointer(a,d,e,f,g,h),c.mem.vertexAttribPointer(a,d,e,f,g,h))};var k={};c.bindTexture=function(a,c){(k.program!==d.program||k[a]!==c)&&(b.bindTexture(a,c),k[a]=c,k.program=d.program)};var l={};c.activeTexture=function(a){l.texture!==a&&(b.activeTexture(a),l.texture=a)};var m={a0:null,a1:null,a2:null,a3:null};c.viewport=function(a,c,d,e){(m.a0!==a||m.a1!==c||m.a2!==d||m.a3!==e)&&(b.viewport(a,c,d,e),m.a0=a,m.a1=c,m.a2=d,m.a3=e)};var n=[null,null];c.blendFunc=function(a,c){(n[0]!==a||n[1]!==c)&&(b.blendFunc(a,c),n[0]=a,n[1]=c)};var o={a0:null,a1:null,a2:null,a3:null};c.clearColor=function(a,c,d,e){(o.a0!==a||o.a1!==c||o.a2!==d||o.a3!==e)&&(b.clearColor(a,c,d,e),o.a0=a,o.a1=c,o.a2=d,o.a3=e)};var p={};return c.enable=function(a){p[a]!==!0&&(b.enable(a),p[a]=!0)},c.disable=function(a){p[a]!==!1&&(b.disable(a),p[a]=!1)},c}),a.set("service.console.logo",function(){var a=function(a,b,c,d){var e=14,f=window.location,g="";g+=" font-size: "+e+"; ",g+=" margin-top: 20px; ",g+=" margin-bottom: 20px; ",g+=" line-height: "+e+"px; ",g+=" padding-top: "+b+"px; ",g+=" padding-left: "+a+"px; ",g+=' background: url("'+f.protocol+"//"+f.host+f.pathname+c+'"); ',g+=" background-position: top center; ",g+=" background-repeat:no-repeat; ";var h="\n",i=b/e-1;if(i>1)for(var j=0;i>=j;j++)h+="\n";return console.log(h+"%c",g),d&&console.log(d),""};return a(128,64,"images/texture/webgl.png","WebGL Widget for Khronos Group"),{say:a}}),a.set("service.lazyGL",function(){return a.get("util.lazyGL")()}),window.domReady=function(a){return document.addEventListener?void document.addEventListener("DOMContentLoaded",a,!1):void(window.onload=a)},window.domReady(function(){a.get("run")(),a.get("service.console.logo")})}(window._di),function(a){"use strict";a.set("const",function(){var a={FloatType:"FloatType"};return a}),a.val("util.makeFloatFBO",function(){var b=a.get("const"),c=a.get("util.makeFBO")({textureType:b.FloatType});return c}),a.val("util.makeFBO",function(b){b=b||{};var c={},d=a.get("service.lazyGL"),e=a.get("context"),f=e.viewportWidth,g=e.viewportHeight,h=e.createTexture();d.bindTexture(e.TEXTURE_2D,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,f,g,0,e.RGBA,e.UNSIGNED_BYTE,null),c.rttTexture=h;var i=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,i),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,f,g);var j=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,j),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,h,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,i),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),c.bindFrameBuffer=function(){e.bindFramebuffer(e.FRAMEBUFFER,j)},c.unbindFrameBuffer=function(){e.bindFramebuffer(e.FRAMEBUFFER,null)};var k=e.createBuffer();k.logoVertex=[-1,-1,1,-1,-1,1,-1,1,1,-1,1,1],k.itemSize=2,k.numItems=6,e.bindBuffer(e.ARRAY_BUFFER,k),e.bufferData(e.ARRAY_BUFFER,new Float32Array(k.logoVertex),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null);var l=e.createBuffer();return l.textureCoords=[0,0,1,0,0,1,0,1,1,0,1,1],l.itemSize=2,l.numItems=6,e.bindBuffer(e.ARRAY_BUFFER,l),e.bufferData(e.ARRAY_BUFFER,new Float32Array(l.textureCoords),e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),c.bindPostProcess=function(a,b){d.useProgram(a.program),d.lazy.vertexAttribPointer(e.ARRAY_BUFFER,k,a.aVertexPosition,k.itemSize,e.FLOAT,!1,0,0),d.lazy.vertexAttribPointer(e.ARRAY_BUFFER,l,a.aTextureCoord,l.itemSize,e.FLOAT,!1,0,0),d.activeTexture(e.TEXTURE0),d.bindTexture(e.TEXTURE_2D,b||h),d.uniform1i(a.uSampler,0)},c.draw=function(a){d.useProgram(a.program),e.drawArrays(e.TRIANGLES,0,k.numItems),d.bindTexture(e.TEXTURE_2D,null)},c})}(window._di),function(a){"use strict";a.set("postProcessProgram",function(){var b={};return b.blur=a.get("program.post.blur"),b}),a.set("renderables",function(){var b={};return b.logo=a.get("renderable.logoFan").init(),b.cube=a.get("renderable.cube").init(),b.particle=a.get("renderable.gpu.particle").init(),b}),a.set("service.postProcess",function(){var b=a.get("util.makeFBO")(),c={};return c.renderPass=function(a,c){c&&"blur"===c.type?(b.bindFrameBuffer(),a(),b.unbindFrameBuffer(),b.bindPostProcess(c),c.simulate(),b.draw(c)):a()},c}),a.set("stages",function(){function b(){h.nowIndex=j++,h.now=g[h.nowIndex],h.clear=!0,h.now.eng.updateMode&&i.addTask(h.now.eng.updateMode,h.now.eng,h.now.mode),j>=g.length&&(j=0),setTimeout(b,h.now.next||5e3)}var c=a.get("postProcessProgram"),d=a.get("renderables"),e=a.get("service.support"),f=[{eng:d.cube,post:c.blur,next:4e3},{eng:d.logo,post:c.blur,next:4e3}],g=[{eng:d.cube,post:c.blur,next:4e3},{eng:d.particle,mode:5,next:4e3},{eng:d.particle,post:c.blur,mode:2,next:4e3},{eng:d.particle,mode:1,next:4e3},{eng:d.particle,mode:3,next:5e3},{eng:d.particle,mode:4,next:5e3},{eng:d.particle,post:c.blur,mode:2,next:4e3}];e.gpuSim||(g=f);var h={now:null,currentIndex:0,clear:!0},i=a.get("service.frbt"),j=0;return b(),h}),a.set("render",function(){var b=a.get("stages"),c=a.get("service.postProcess"),d=function(){var a=b.now;a.eng&&"GpuParticle"===a.eng.type?a.eng.render(a.post):a.post&&"blur"===a.post.type||a.post&&"normal"===a.post.type?c.renderPass(a.eng.render,a.post):a.eng.render()},e=a.get("service.frbt"),f=function(){e.addTask(d)};return f}),a.val("run",function(){var b=a.get("canvas"),c=a.get("context");if(!c){console.log(" no webgl ....");var d=document,e=d.documentElement,f=function(a){return d.getElementById(a)},g=f("msg");g.style.display="block";var h=f("ln"),i=h.innerHTML;i=i.replace("support","fully support"),i=i.replace("canvas","WebGL"),i+=" Click here to learn more.",h.innerHTML=i;var j=f("ww");return g.innerHTML+="<br>"+j.innerHTML,e.appendChild(g),void(b.style.display="none")}a.get("service.contextLost"),a.get("loop").start()})}(window._di),function(a){"use strict";a.set("renderable.logoFan",function(){function b(a,b){this.rDegree=0,this.rSpeed=a,this.r=Math.random(),this.g=Math.random(),this.b=Math.random(),this.parent=b}function c(){this.logoFan=[],this.numLogos=20,this.zoom=-7,this.tilt=45,this.logoTexture=null,this.logoVPBO=null,this.logoVTCBO=null,this.keyDown=j}var d=a.get("context"),e=a.get("service.lazyGL"),f=a.get("service.clock"),g=a.get("program.fan"),h=a.get("util.mvStack")(),i=a.get("util.degToRad"),j=a.get("service.keydown"),k=a.get("service.frbt");b.prototype.drawLogo=function(){this.parent.logoTexture.$ready?(e.uniform1i(g.tReady,1),e.activeTexture(d.TEXTURE0),e.bindTexture(d.TEXTURE_2D,this.parent.logoTexture),e.uniform1i(g.uSampler,0)):e.uniform1i(g.tReady,0),e.lazy.vertexAttribPointer(d.ARRAY_BUFFER,this.parent.logoVPBO,g.aVertexPosition,this.parent.logoVPBO.itemSize,d.FLOAT,!1,0,0),e.lazy.vertexAttribPointer(d.ARRAY_BUFFER,this.parent.logoVTCBO,g.aTextureCoord,this.parent.logoVTCBO.itemSize,d.FLOAT,!1,0,0),e.uniformMatrix4fv(g.uMVMatrix,!1,h.mvMatrix),this.parent.logoTexture.$ready?d.drawArrays(d.TRIANGLE_STRIP,0,this.parent.logoVPBO.numItems):d.drawArrays(d.TRIANGLE_STRIP,0,this.parent.logoVPBO.numItems)},b.eFPS=.055,b.prototype.simulate=function(a){this.rDegree+=this.rSpeed*a*b.eFPS},b.prototype.draw=function(){h.mvSave(),mat4.rotate(h.mvMatrix,h.mvMatrix,i(this.rDegree),[0,1,0]),mat4.rotate(h.mvMatrix,h.mvMatrix,Math.sin(i(this.rDegree)),[0,1,0]),mat4.rotate(h.mvMatrix,h.mvMatrix,i(this.rDegree)/10,[0,1,0]),mat4.translate(h.mvMatrix,h.mvMatrix,[2.3,0,0]),mat4.rotate(h.mvMatrix,h.mvMatrix,i(-30),[1,0,0]),e.uniform3f(g.uColor,this.r,this.g,this.b),this.drawLogo(),h.mvRestore()},c.prototype.processTexutre=function(a){e.useProgram(g.program),e.bindTexture(d.TEXTURE_2D,a),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!0),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,a.image),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),e.bindTexture(d.TEXTURE_2D,null),a.$ready=!0},c.prototype.initTexture=function(){var a=this;this.logoTexture=d.createTexture(),this.logoTexture.image=new Image,this.logoTexture.image.onload=function(){k.addTask(a.processTexutre,a,a.logoTexture)},this.logoTexture.image.src="images/texture/webgl.png"},c.prototype.initBuffers=function(){this.logoVPBO=d.createBuffer(),this.logoVPBO.logoVertex=[-2,-1,0,2,-1,0,-2,1,0,2,1,0],d.bindBuffer(d.ARRAY_BUFFER,this.logoVPBO),d.bufferData(d.ARRAY_BUFFER,new Float32Array(this.logoVPBO.logoVertex),d.STATIC_DRAW),this.logoVPBO.itemSize=3,this.logoVPBO.numItems=4,this.logoVTCBO=d.createBuffer(),this.logoVTCBO.textureCoords=[0,0,1,0,0,1,1,1],d.bindBuffer(d.ARRAY_BUFFER,this.logoVTCBO),d.bufferData(d.ARRAY_BUFFER,new Float32Array(this.logoVTCBO.textureCoords),d.STATIC_DRAW),this.logoVTCBO.itemSize=2,this.logoVTCBO.numItems=4},c.prototype.init=function(){this.initBuffers(),this.initTexture(),this.makeLogoFan()},c.prototype.makeLogoFan=function(){for(var a,c=this.numLogos,d=0;c>d;d++)a=new b(d/c*1.7,this),this.logoFan.push(a)},c.prototype.handleDownKeys=function(){this.keyDown[38]&&(this.tilt+=2),this.keyDown[40]&&(this.tilt-=2),this.keyDown[87]&&(this.zoom+=.1),this.keyDown[83]&&(this.zoom-=.1)},c.prototype.v8Each=function(a,b,c){for(var d=0,e=a.length;e>d;d++)b.call(a[d],c)},c.prototype.drawAllLogo=function(){e.useProgram(g.program),e.disable(d.DEPTH_TEST),e.enable(d.BLEND),e.blendFunc(d.SRC_ALPHA,d.ONE),e.viewport(0,0,d.viewportWidth,d.viewportHeight),e.clearColor(0,0,0,1),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT),mat4.perspective(h.pMatrix,45,d.viewportWidth/d.viewportHeight,.1,100),e.uniformMatrix4fv(g.uPMatrix,!1,h.pMatrix),mat4.identity(h.mvMatrix),mat4.translate(h.mvMatrix,h.mvMatrix,[0,0,this.zoom]),mat4.rotate(h.mvMatrix,h.mvMatrix,i(this.tilt),[1,0,0]),mat4.scale(h.mvMatrix,h.mvMatrix,[1,1,1]);for(var a=this.logoFan,b=0,c=a.length;c>b;b++)a[b].draw()},c.prototype.simulate=function(){var a=f.eTime;a&&this.v8Each(this.logoFan,b.prototype.simulate,a)},c.prototype.render=function(){this.handleDownKeys(),this.drawAllLogo(),this.simulate()};var l,m={};return m.init=function(){return l=new c,l.init(),m},m.render=function(){l.render()},m})}(window._di),function(a){"use strict";a.set("renderable.cube",function(){function b(a,b){var c=e.createTexture();return c.$index=a||0,c.$image=new Image,c.$image.onload=function(){h.addTask(function(){f.useProgram(k.program),e.activeTexture(e.TEXTURE0+c.$index),e.bindTexture(e.TEXTURE_2D,c),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c.$image),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null),c.$ready=!0})},c.$image.src=b,c}function c(){f.useProgram(k.program),f.disable(e.BLEND),f.enable(e.DEPTH_TEST),f.viewport(0,0,e.viewportWidth,e.viewportHeight),f.clearColor(1,1,1,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),mat4.perspective(i.pMatrix,45,e.viewportWidth/e.viewportHeight,.1,100),f.uniformMatrix4fv(k.uPMatrix,!1,i.pMatrix),i.mvSave(),mat4.identity(i.mvMatrix),mat4.translate(i.mvMatrix,i.mvMatrix,[0,0,-5]),mat4.rotate(i.mvMatrix,i.mvMatrix,-j(l.rotation.x),[1,0,0]),mat4.rotate(i.mvMatrix,i.mvMatrix,l.rotation.y,[0,1,0]),f.uniformMatrix4fv(k.uMVMatrix,!1,i.mvMatrix),i.mvRestore(),f.lazy.vertexAttribPointer(e.ARRAY_BUFFER,m,k.aVertexPosition,m.itemSize,e.FLOAT,!1,0,0),f.lazy.vertexAttribPointer(e.ARRAY_BUFFER,n,k.aTextureCoord,n.itemSize,e.FLOAT,!1,0,0),p.$ready?(f.activeTexture(e.TEXTURE0),f.bindTexture(e.TEXTURE_2D,p),f.uniform1i(k.uSReady,1),f.uniform1i(k.uSampler,0)):f.uniform1i(k.uSReady,0),e.uniform1f(k.uTimer,256*g.sTime%2200),f.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o),p.$ready?e.drawElements(e.TRIANGLES,o.numItems,e.UNSIGNED_SHORT,0):e.drawElements(e.TRIANGLES,o.numItems,e.UNSIGNED_SHORT,0)}function d(){var a=g.eTime,b=g.cTime;a&&(l.rotation.x+=90*a/1e3,l.rotation.y=Math.sin(b/100)/10,l.rotation.z+=90*a/1e3)}var e=a.get("context"),f=a.get("service.lazyGL"),g=a.get("service.clock"),h=a.get("service.frbt"),i=a.get("util.mvStack")(),j=a.get("util.degToRad"),k=a.get("program.cube.sampler"),l={rotation:{x:0,y:0,z:0},cubeMap:null},m=e.createBuffer();m.array=[-2,-1,1,2,-1,1,2,1,1,-2,1,1,-2,-1,-1,-2,1,-1,2,1,-1,2,-1,-1,-2,1,-1,-2,1,1,2,1,1,2,1,-1,-2,-1,-1,2,-1,-1,2,-1,1,-2,-1,1,2,-1,-1,2,1,-1,2,1,1,2,-1,1,-2,-1,-1,-2,-1,1,-2,1,1,-2,1,-1],m.itemSize=3,m.numItems=24,e.bindBuffer(e.ARRAY_BUFFER,m),e.bufferData(e.ARRAY_BUFFER,new Float32Array(m.array),e.STATIC_DRAW);var n=e.createBuffer();n.array=[0,0,1,0,1,1,0,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],n.itemSize=2,n.numItems=24,e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n.array),e.STATIC_DRAW);var o=e.createBuffer();o.array=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,16,17,18,16,18,19,12,13,14,12,14,15,20,21,22,20,22,23],o.itemSize=1,o.numItems=36,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(o.array),e.STATIC_DRAW);var p;p=b(0,"./images/texture/webgl.png");var q={};return q.render=function(){c(),d()},q.init=function(){return q},q})}(window._di),function(a){"use strict";a.set("renderable.gpu.particle",function(){function b(){this.rttFBO1=a.get("util.makeFloatFBO")(),this.rttFBO2=a.get("util.makeFloatFBO")(),this.toggleMap=a.get("service.toggle"),this.currentFBO=null,this.pingPongIndex=0,this.program=a.get("program.particle.simulate"),this.prebind={updateMode:this.updateMode.bind(this)}}function c(){this.program=a.get("program.particle.show"),this.particleBuffer=null,this.particle=null,this.keyDown=i,this.gpuSim=new b(this),this.prebind={draw:this.draw.bind(this),render:this.render.bind(this)},this.tiltX=127,this.tiltY=28.5,this.zoom=-332.5}var d=a.get("context"),e=a.get("service.lazyGL"),f=a.get("service.clock"),g=a.get("util.mvStack")(),h=a.get("util.degToRad"),i=a.get("service.keydown"),j=a.get("service.postProcess"),k={};k.type="GpuParticle",b.prototype.updateMode=function(a){e.useProgram(this.program.program),e.uniform1i(this.program.uMode,a||1)
},b.prototype.simulate=function(){var a,b;this.pingPongIndex%2===0?(a=this.rttFBO1,b=this.rttFBO2):(b=this.rttFBO1,a=this.rttFBO2),this.currentFBO=b,this.pingPongIndex++,this.toggleMap[80]!==!0&&(b.bindFrameBuffer(),b.bindPostProcess(this.program,a.rttTexture),this.program.simulate(),b.draw(this.program),b.unbindFrameBuffer())},c.prototype.simulate=function(){this.keyDown[38]||this.keyDown[40]||this.keyDown[37]||this.keyDown[39]||(this.tiltX%=360,this.tiltY%=360,this.tiltX-=.33+Math.cos(f.sTime),this.tiltY-=(1-Math.sin(f.sTime))/2)},c.prototype.handleDownKeys=function(){this.keyDown[38]&&(this.tiltY+=1.5),this.keyDown[40]&&(this.tiltY-=1.5),this.keyDown[37]&&(this.tiltX+=1.5),this.keyDown[39]&&(this.tiltX-=1.5),this.keyDown[87]&&(this.zoom+=1,this.zoom%=500),this.keyDown[83]&&(this.zoom-=1,this.zoom%=-500)},c.prototype.makeParticle=function(){for(var a,b,c,e=d.viewportWidth,f=d.viewportHeight,g=0,h=e*f/3,i=[];h>g;g++)a=g%e/e,b=Math.floor(g/e)/f,c=0,i.push(a),i.push(b);this.particle=new Float32Array(i)},c.prototype.initGraphics=function(){this.particleBuffer=d.createBuffer(),this.particleBuffer.itemSize=2,this.particleBuffer.numItems=this.particle.length/this.particleBuffer.itemSize,d.bindBuffer(d.ARRAY_BUFFER,this.particleBuffer),d.bufferData(d.ARRAY_BUFFER,this.particle,d.STATIC_DRAW)},c.prototype.init=function(){this.makeParticle(),this.initGraphics()},c.prototype.draw=function(){e.clearColor(.2,.2,.2,1),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT),e.useProgram(this.program.program),e.disable(d.DEPTH_TEST),e.enable(d.BLEND),e.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA),e.viewport(0,0,d.viewportWidth,d.viewportHeight),mat4.perspective(g.pMatrix,45,d.viewportWidth/d.viewportHeight,.1,1e3),e.uniformMatrix4fv(this.program.uPMatrix,!1,g.pMatrix),g.mvSave(),mat4.identity(g.mvMatrix),mat4.translate(g.mvMatrix,g.mvMatrix,[0,0,this.zoom]),mat4.rotate(g.mvMatrix,g.mvMatrix,h(this.tiltY),[1,0,0]),mat4.rotate(g.mvMatrix,g.mvMatrix,h(this.tiltX),[0,1,0]),e.uniformMatrix4fv(this.program.uMVMatrix,!1,g.mvMatrix),g.mvRestore(),e.activeTexture(d.TEXTURE0),e.bindTexture(d.TEXTURE_2D,this.gpuSim.currentFBO.rttTexture),e.uniform1i(this.program.uSampler,0),e.lazy.vertexAttribPointer(d.ARRAY_BUFFER,this.particleBuffer,this.program.aVertexPosition,this.particleBuffer.itemSize,d.FLOAT,!1,0,0),d.uniform1f(this.program.uTimer,500*f.sTime),d.drawArrays(d.POINTS,0,this.particleBuffer.numItems),e.bindTexture(d.TEXTURE_2D,null)},c.prototype.render=function(a){this.handleDownKeys(),this.gpuSim.simulate(),a?j.renderPass(this.prebind.draw,a):this.draw(),this.simulate()};var l;return k.init=function(){return l=new c,l.init(),k.updateMode=l.gpuSim.prebind.updateMode,k.render=l.prebind.render,k},k})}(window._di),function(a){"use strict";a.put("scripts/shaders/cube.sampler.fs","precision mediump float;varying vec2 vTextureCoord;uniform float uTimer;uniform int uSReady;uniform sampler2D uSampler;float rand(vec2 co){return fract(sin(dot(co,vec2(32.45884,64.23432))*74.582974)*49.9478593);}void main(void){vec4 textureColor=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));float randomVal=rand(vec2(sin(uTimer)*cos(uTimer)-vTextureCoord.s,sin(uTimer)*cos(uTimer)-vTextureCoord.t));vec4 randomColor=vec4(sin(uTimer*vTextureCoord.s),cos(uTimer*vTextureCoord.t),sin(uTimer*randomVal),1.0);if(uSReady==1){gl_FragColor=(1.24-textureColor)*randomColor;}else{gl_FragColor=randomColor;}}"),a.put("scripts/shaders/cube.sampler.vs","attribute vec3 aVertexPosition;attribute vec2 aTextureCoord;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;varying vec2 vTextureCoord;void main(void){gl_Position=uPMatrix*uMVMatrix*vec4(aVertexPosition,1.0);vTextureCoord=aTextureCoord;}"),a.put("scripts/shaders/fan.fs","precision mediump float;uniform sampler2D uSampler;uniform vec3 uColor;uniform int tReady;varying vec2 vTextureCoord;void main(void){vec4 textureColor=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));if(tReady==1){gl_FragColor=textureColor*vec4(uColor,1.0);}else{gl_FragColor=vec4(uColor,1.0);}}"),a.put("scripts/shaders/fan.vs","attribute vec3 aVertexPosition;attribute vec2 aTextureCoord;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;varying vec2 vTextureCoord;void main(void){gl_Position=uPMatrix*uMVMatrix*vec4(aVertexPosition,1.0);vTextureCoord=aTextureCoord;}"),a.put("scripts/shaders/particle.show.fs","precision mediump float;uniform float uTimer;float opacity=0.2;float rand(vec2 co){return fract(sin(dot(co,vec2(32.45884,64.23432))*74.582974)*49.9478593);}void main(void){float sinTime=sin(uTimer/100.0);float cosTime=cos(uTimer/100.0);float tanTime=tan(uTimer/100.0);float randomNum=rand(vec2(sinTime,cosTime));float randomNum2=rand(vec2(cosTime,tanTime));float randomNum3=rand(vec2(tanTime,sinTime));vec3 rgb=vec3(randomNum,randomNum2,randomNum3);gl_FragColor=vec4(rgb,opacity);}"),a.put("scripts/shaders/particle.show.vs","attribute vec2 aVertexPosition;uniform mat4 uMVMatrix;uniform mat4 uPMatrix;uniform sampler2D uSampler;void main(void){vec2 vert2dPos=aVertexPosition.xy+vec2(0.5/200.0,0.5/200.0);vec3 vert3dPos=texture2D(uSampler,vert2dPos).xyz*200.0-100.0;gl_Position=uPMatrix*uMVMatrix*vec4(vert3dPos,1.0);gl_PointSize=1.0;}"),a.put("scripts/shaders/particle.simulate.fs","precision highp float;uniform sampler2D uSampler;varying vec2 vTextureCoord;uniform float uTimer;float rand(vec2 co){return fract(sin(dot(co.xy,vec2(59.454233,72.223432))*0.32457)*2342.0);}uniform int uMode;void main(){vec2 vTC=vTextureCoord;int mode;if(uMode!=0){mode=uMode;}else{mode=1;}float opacity=0.05;vec4 nextPos=vec4(opacity);vec4 lastPos=texture2D(uSampler,vTC);float rVal=rand(vec2(vTC.x,vTC.y));float sinTime=sin(uTimer/500.0);float cosTime=cos(uTimer/500.0);float tanTime=tan(uTimer/500.0);vec4 fSpace=vec4(sinTime*sin(uTimer*rVal+vTC.s),cosTime*cos(uTimer*rVal+vTC.t),cosTime*sinTime*tan(uTimer*rVal),opacity);if(mode==1){nextPos=fSpace;}else if(mode==2){vec4 fEdge=vec4(sinTime*sin(uTimer*vTC.s/1000.0),cosTime*cos(uTimer*vTC.t/1000.0),sinTime*sin(uTimer*1.0/rVal),opacity);nextPos=fSpace;nextPos+=fEdge;}else if(mode==3){nextPos=vec4(sinTime*sin(uTimer*rVal+vTC.s),cosTime*cos(uTimer*rVal+vTC.t),tanTime*sinTime*sin(uTimer*rVal),opacity);}else if(mode==4){vec4 sEdge=vec4(sinTime*sin(uTimer*rVal+vTC.s),cosTime*sin(uTimer*rVal+vTC.t),cosTime*sin(uTimer*rVal),opacity);nextPos=sEdge;}else if(mode==5){vec4 eSignal=vec4(tanTime*sin(uTimer*rVal*cosTime*vTC.s),tanTime*sin(uTimer*rVal*sinTime*vTC.t),tanTime*sin(uTimer*rVal*cosTime),opacity);nextPos=eSignal;}nextPos+=lastPos;gl_FragColor=nextPos;}"),a.put("scripts/shaders/particle.simulate.vs","attribute vec2 aVertexPosition;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=vec2(aTextureCoord.x,1.0-aTextureCoord.y);gl_Position=vec4(aVertexPosition,0.0,1.0);}"),a.put("scripts/shaders/post.blur.fs","precision mediump float;uniform sampler2D uSampler;varying vec2 vTextureCoord;varying vec2 vK[6];void main(){vec4 _c=vec4(0.0);_c+=texture2D(uSampler,vK[2])*0.0044299121055113265;_c+=texture2D(uSampler,vK[0])*0.00895781211794;_c+=texture2D(uSampler,vK[2])*0.0215963866053;_c+=texture2D(uSampler,vK[4])*0.0443683338718;_c+=texture2D(uSampler,vK[0])*0.0776744219933;_c+=texture2D(uSampler,vK[2])*0.115876621105;_c+=texture2D(uSampler,vK[4])*0.147308056121;_c+=texture2D(uSampler,vTextureCoord)*0.159576912161;_c+=texture2D(uSampler,vK[5])*0.147308056121;_c+=texture2D(uSampler,vK[3])*0.115876621105;_c+=texture2D(uSampler,vK[1])*0.0776744219933;_c+=texture2D(uSampler,vK[5])*0.0443683338718;_c+=texture2D(uSampler,vK[3])*0.0215963866053;_c+=texture2D(uSampler,vK[1])*0.00895781211794;_c+=texture2D(uSampler,vK[3])*0.0044299121055113265;gl_FragColor=_c;}"),a.put("scripts/shaders/post.blur.vs","attribute vec2 aVertexPosition;attribute vec2 aTextureCoord;uniform float uVibrate;varying vec2 vTextureCoord;varying vec2 vK[6];void main(){vec2 vTC=aTextureCoord;float cv=uVibrate;vTC=aTextureCoord;gl_Position=vec4(aVertexPosition,0.0,1.0);vK[0]=vTC+vec2(cv*-0.024,cv*-0.02);vK[1]=vTC+vec2(cv*-0.016,cv*-0.01);vK[2]=vTC+vec2(cv*-0.008,cv*-0.00);vK[3]=vTC+vec2(cv*0.004,cv*0.00);vK[4]=vTC+vec2(cv*0.012,cv*0.01);vK[5]=vTC+vec2(cv*0.020,cv*0.02);vTextureCoord=vTC;}"),a.put("scripts/shaders/post.normal.fs","precision mediump float;uniform sampler2D uSampler;varying vec2 vTextureCoord;void main(){vec4 frameColor=texture2D(uSampler,vTextureCoord);gl_FragColor=frameColor;}"),a.put("scripts/shaders/post.normal.vs","attribute vec2 aVertexPosition;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=vec2(aTextureCoord.x,aTextureCoord.y);gl_Position=vec4(aVertexPosition,0.0,1.0);}")}({put:window._di.val});